language: java

jdk:
  - oraclejdk8

dist: trusty

branches:
  only:
  - master
  - test

cache:
  directories:
    - $HOME/.m2

addons:
  sonarcloud:
    organization: "google-cloud-spanner-hibernate"
    token:
      secure: "p8JnEu/1hwH865RiacIBDDTpYYLpxaueEcw/FvaPNi3+83FbKlLfQbM48FtVgDgo1e9OIlmdL3fvjedlxGZLoWkQ4T81Iv2NqSZDfu4fQgMGRAp36AbKPzWmNJpddUf+Wyvw0oEhRvSYXzthL66wufGgri7dy8P6N9WW0+1CI6q3P1aDc656TDhQzllnN8t7uIknzk3SNptYqZbN8mVf7hDlLnA0rVc+T3UeYewZVwGm9HEx6+ZEQYzAxW34Q50vxhDwp1Mrw6O1+CzSUdZoHelM8rt8HvrU0Ha+nI+FX5ldoJWdi9Wftm+TS4YbSm0rel8Wwn7t+n3Kl/nLdcLRN+inGUoSTJevJ0pOIz87sA05Mo7I3i7V3Ncm600dOazSxWdumimFWvTg9Kpsuvjzp1Lv6OP4GOCMy55nyEk1vkKDxPiiGrHkFGN7gxmIlaZBmqy2peVViUDuVzbIgis2Clk4qGVhuZ1GfjGJh1/UX1kB9H4wtvDQVAqFVYa5LmiN1TAAdKUWC780bjMOzRsPWzfOpq5k8El7aqDDuWLK17LUmBfqqf/qhhDdVJoLhn3JkjR24fyfLy6CjvjZ0xLzLAC0wqFrucB28JuF+XhfpcYBp7GH0uqCKHBeVjqHtClJE38w5JHwoeGArLtHChEnU4zASGz6mVemgcu4DUZLK1c="

install:
  - ./mvnw clean install -DskipTests=true -Dmaven.javadoc.skip=true -B -V -P disable-integration-tests;

before_install:
  - if [ "$TRAVIS_SECURE_ENV_VARS" == "true" ]; then
      openssl aes-256-cbc -K $encrypted_d2c20fa49002_key -iv $encrypted_d2c20fa49002_iv -in travis.tar.gz.enc -out travis.tar.gz -d;
      tar -xzf travis.tar.gz;
      export GOOGLE_APPLICATION_CREDENTIALS=$TRAVIS_BUILD_DIR/travis/admin.json;
      export GOOGLE_CLOUD_PROJECT=cloud-spanner-hibernate-ci;
    fi;

script:
  - if [ "$TRAVIS_SECURE_ENV_VARS" == "true" ]; then
      ./mvnw org.jacoco:jacoco-maven-plugin:prepare-agent verify sonar:sonar -B -V Dsonar.projectKey=google-cloud-spanner-hibernate -Dhibernate.show_sql=false;
    else
      ./mvnw verify -B -V -P disable-integration-tests;
    fi;

